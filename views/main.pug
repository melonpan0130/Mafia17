html
    head
        script(src="/socket.io/socket.io.js")
        script(src="https://code.jquery.com/jquery-3.4.1.js" integrity="sha256-WpOohJOqMqqyKL9FccASB9O0KwACQJpFTUBLTYOVvVU="
  crossorigin="anonymous")
        //- script
            include ../js/gameChat.js
        style
            include ../css/gameChat.css
        script.
            var socket = io();
            var name, Roomcode;
            var startTime;
            var jobs = ['mafia', 'doctor', 'police'];
            var status = ['밤이 되었습니다.', '아침이 밝았습니다.', '투표 시간입니다.', '최후의 반론'];

            function validation() {
                var name = document.getElementById('name');
                var room = document.getElementById('room');

                if(name.value == ''){
                    alert('Please Write on your name.');
                    name.focus();
                }
                else if(room.value == ''){
                    alert('Please Write on your room code.');
                    room.focus();
                }
                else
                    enter();
            }
            
            function enter(){
                name = document.getElementById('name').value;
                Roomcode = document.getElementById('room').value;

                $("#popup").addClass("hidden");

                socket.emit('joinRoom', Roomcode, name);

                $('form').submit( () => {
                    socket.emit('chat message', Roomcode, name, $('#m').val());
                    $('#m').val('');
                    return false;
                });

                socket.on('chat message', (name, msg) => {
                    $('#messages').append($('<li>').text(name + '  :  ' +
                    msg));
                });

                socket.on('joined', (Roomcode, name, players) => {
                    $('#messages').append($('<li>').text(name + '    joined '+Roomcode + ':)'));
                    $('#guess>div:first-child').empty();

                    for(var i=0; i<players.length; i++)
                        $('#guess>div:first-child').append(
                            $('<div class="people">').append('<div class="face">').append('<p>'+players[i].name+'</p>')
                        );
                });

                socket.on('gamestart', ()=> {
                    startTime = Date();
                    var time = 30;
                    setInterval(()=> {
                        $('#status').text(status[0]+' ('+time+')');
                        time--;
                    }, 1000);
                    $('#guess>div:last-child>div').addClass('gameGuess').toggleClass('hidden');
                    $('#status').text('밤이 되었습니다. (30)');
                    $('#messages').empty();
                    alert('Game start!');
                });

                socket.on('timer', (time)=> {
                    
                });
            };

            function gameStart() {
                if($('.gameGuess>div').length < 3)
                    alert('3명 이상이어야 합니다.');
                else {
                    socket.emit('starting', Roomcode);
                }
            }

            function exit() {
                var exit = confirm('Are you sure to exit?');
                if(exit){
                    alert('Exited');
                    socket.emit('leave', Roomcode, name);
                    window.location.reload();
                }
            }

            $(window).bind("beforeunload", function() {
                socket.emit('leave', Roomcode, name);
                window.location.reload();
                return ;
            })
    body
        #popup
            table
                tr
                    td: label(for="name") Name
                    td: input(type="text" name="name" placeholder="Name" value="dd" id="name")
                tr
                    td: label(for="room") Room
                    td: input(type="text" name="room" placeholder="Room Code" value="dd" id="room")
                tr
                    td(colspan="2"): input(type="submit" id="enter" value="Enter" onclick="validation()")
        nav Mafia17
        .content
            div: ul(id="history")
            div
                #status 마피아 게임
                #msg: ul(id="messages")
                #chatting
                    form(action="")
                        input(type="text" id="m" autocomplete="off")
                        button send
            #guess
                .gameGuess
                    //- for(var a=0; a<6; a++)
                        .people
                            .face
                            p Mafia
                            p userName
                div
                    div
                        button(onclick="gameStart()") Start
                        button(onclick="exit()") Exit
                    .hidden
                        - var jobs = ['mafia.png', 'police.png', 'doctor.png', 'citizen.png', 'ghost.png', 'spy.png', 'politician.png']
                        for img in jobs
                            .people
                                .face: img(src="/img/job/"+img)
                                p Mafia
                                p userName
            div